<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Korean Pro - Learn Korean with Expert Instruction</title>
  <meta name="description" content="Master Korean language with structured courses, bilingual quizzes, and expert video lessons. EPS-TOPIK preparation available.">
  <meta property="og:title" content="Korean Pro - Korean Learning Platform">
  <meta property="og:description" content="Comprehensive Korean language courses with bilingual support">
  <meta property="og:type" content="website">
  <link rel="manifest" href="#" id="manifest-placeholder">
  <style>
/*
=============================================================================
README & SETUP INSTRUCTIONS
=============================================================================

DEMO CREDENTIALS:
- Admin: admin / admin123
- Students: student1..student6 / student123

TO RUN LOCALLY:
- Use http-server (npm install -g http-server, then run: http-server)
- Or Python: python -m http.server 8000
- Service Worker requires HTTP/HTTPS (localhost works)

PRODUCTION REPLACEMENTS NEEDED:
1. AUTH: Replace localStorage auth with Firebase Auth, Auth0, or backend API
2. PAYMENT: Integrate real payment gateway (Stripe, PayPal, local bank API)
3. VIDEO HOSTING: Host on S3, Vimeo Pro, or dedicated CDN with proper DRM
4. DATABASE: Replace localStorage with PostgreSQL/MongoDB via API
5. SERVICE WORKER: Deploy proper caching strategy and update mechanism
6. SECURITY: Add CSRF tokens, rate limiting, input validation on backend
7. EMAIL: Integrate SendGrid/AWS SES for real notifications

FEATURES INCLUDED:
‚úì Demo authentication with localStorage
‚úì Admin panel for user/content management
‚úì Bank transfer payment workflow with admin approval
‚úì Paid-only recordings portal with video player
‚úì Bilingual quiz system (Korean/Sinhala toggle)
‚úì Daily quiz scheduling and tracking
‚úì Student dashboard with progress tracking
‚úì PWA manifest and service worker
‚úì Responsive mobile-first design
‚úì Light/Dark mode with brand colors
‚úì 3 demo lessons + 10 demo quizzes
=============================================================================
*/

    :root {
      --primary: #1e40af;
      --primary-dark: #1e3a8a;
      --dark: #1f2937;
      --accent: #f59e0b;
      --bg: #ffffff;
      --surface: #f3f4f6;
      --text: #1f2937;
      --text-light: #6b7280;
      --border: #e5e7eb;
      --success: #10b981;
      --error: #ef4444;
    }

    [data-theme="dark"] {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --dark: #111827;
      --bg: #0f172a;
      --surface: #1e293b;
      --text: #f1f5f9;
      --text-light: #94a3b8;
      --border: #334155;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: background 0.3s, color 0.3s;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }

    /* NAVIGATION */
    .navbar {
      background: var(--primary);
      color: white;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo-accent {
      color: var(--accent);
    }

    .nav-links {
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }

    .nav-links a, .nav-links button {
      color: white;
      text-decoration: none;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      transition: opacity 0.2s;
    }

    .nav-links a:hover, .nav-links button:hover {
      opacity: 0.8;
    }

    .hamburger {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* CARDS */
    .card {
      background: var(--surface);
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text);
    }

    /* BUTTONS */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-accent {
      background: var(--accent);
      color: var(--dark);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-error {
      background: var(--error);
      color: white;
    }

    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }

    /* FORMS */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text);
    }

    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
      font-size: 1rem;
    }

    /* PAGES */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* AUTH PAGES */
    .auth-container {
      max-width: 400px;
      margin: 4rem auto;
    }

    /* DASHBOARD */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      opacity: 0.9;
      font-size: 0.9rem;
    }

    /* VIDEO PLAYER */
    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .video-container iframe, .video-container video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* QUIZ */
    .quiz-option {
      padding: 1rem;
      margin-bottom: 0.5rem;
      border: 2px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-option:hover {
      border-color: var(--primary);
      background: var(--surface);
    }

    .quiz-option.correct {
      border-color: var(--success);
      background: rgba(16, 185, 129, 0.1);
    }

    .quiz-option.incorrect {
      border-color: var(--error);
      background: rgba(239, 68, 68, 0.1);
    }

    /* PROGRESS BAR */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s;
    }

    /* TOGGLE SWITCH */
    .toggle-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .toggle {
      position: relative;
      width: 50px;
      height: 26px;
      background: var(--border);
      border-radius: 13px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle.active {
      background: var(--primary);
    }

    .toggle-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle.active .toggle-slider {
      transform: translateX(24px);
    }

    /* TABLE */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    th {
      font-weight: 600;
      background: var(--surface);
    }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 200;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--bg);
      border-radius: 8px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    /* MOBILE */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
      }
      
      .hamburger {
        display: block;
      }

      .mobile-menu {
        display: none;
        position: fixed;
        top: 60px;
        left: 0;
        right: 0;
        background: var(--primary);
        padding: 1rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }

      .mobile-menu.active {
        display: block;
      }

      .mobile-menu a {
        display: block;
        color: white;
        padding: 0.75rem;
        text-decoration: none;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    /* UTILITIES */
    .hidden { display: none !important; }
    .mt-1 { margin-top: 1rem; }
    .mb-1 { margin-bottom: 1rem; }
    .text-center { text-align: center; }
    .text-success { color: var(--success); }
    .text-error { color: var(--error); }
    .flex { display: flex; }
    .gap-1 { gap: 1rem; }
    .justify-between { justify-content: space-between; }
    .items-center { align-items: center; }
  </style>
</head>
<body data-theme="light">

  <!-- NAVIGATION -->
  <nav class="navbar">
    <div class="nav-content">
      <div class="logo">
        <svg width="30" height="30" viewBox="0 0 30 30">
          <circle cx="15" cy="15" r="15" fill="currentColor" opacity="0.2"/>
          <text x="15" y="20" text-anchor="middle" fill="var(--accent)" font-size="16" font-weight="bold">K</text>
        </svg>
        <span>Korean<span class="logo-accent">Pro</span></span>
      </div>
      <div class="nav-links" id="navLinks">
        <!-- Dynamic nav items loaded by JS -->
      </div>
      <button class="hamburger" id="hamburgerBtn">‚ò∞</button>
    </div>
  </nav>

  <!-- MOBILE MENU -->
  <div class="mobile-menu" id="mobileMenu">
    <!-- Dynamic mobile nav items -->
  </div>

  <!-- PAGES -->
  <div id="app">
    
    <!-- LOGIN PAGE -->
    <div id="loginPage" class="page active">
      <div class="auth-container">
        <div class="card">
          <h2 class="card-title text-center">Login to Korean Pro</h2>
          <form id="loginForm">
            <div class="form-group">
              <label>Username</label>
              <input type="text" id="loginUsername" required>
            </div>
            <div class="form-group">
              <label>Password</label>
              <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            <p class="text-center mt-1">
              Don't have an account? <a href="#" id="showSignupLink">Sign up</a>
            </p>
          </form>
        </div>
      </div>
    </div>

    <!-- SIGNUP PAGE -->
    <div id="signupPage" class="page">
      <div class="auth-container">
        <div class="card">
          <h2 class="card-title text-center">Create Account</h2>
          <form id="signupForm">
            <div class="form-group">
              <label>Username</label>
              <input type="text" id="signupUsername" required>
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="signupEmail" required>
            </div>
            <div class="form-group">
              <label>Password</label>
              <input type="password" id="signupPassword" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
            <p class="text-center mt-1">
              Already have an account? <a href="#" id="showLoginLink">Login</a>
            </p>
          </form>
        </div>
      </div>
    </div>

    <!-- DASHBOARD PAGE -->
    <div id="dashboardPage" class="page">
      <div class="container">
        <h1>Dashboard</h1>
        <div class="dashboard-grid" id="dashboardStats">
          <!-- Stats cards loaded by JS -->
        </div>
        <div class="card">
          <h3 class="card-title">Your Progress</h3>
          <div id="progressContent">
            <!-- Progress info loaded by JS -->
          </div>
        </div>
      </div>
    </div>

    <!-- RECORDINGS PAGE -->
    <div id="recordingsPage" class="page">
      <div class="container">
        <h1>Video Recordings</h1>
        <div id="recordingsContent">
          <!-- Content loaded by JS -->
        </div>
      </div>
    </div>

    <!-- QUIZZES PAGE -->
    <div id="quizzesPage" class="page">
      <div class="container">
        <div class="flex justify-between items-center mb-1">
          <h1>Daily Quizzes</h1>
          <div class="toggle-container">
            <span>ÌïúÍ∏Ä</span>
            <div class="toggle" id="quizLangToggle">
              <div class="toggle-slider"></div>
            </div>
            <span>‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</span>
          </div>
        </div>
        <div id="quizzesContent">
          <!-- Quizzes loaded by JS -->
        </div>
      </div>
    </div>

    <!-- PAYMENT PAGE -->
    <div id="paymentPage" class="page">
      <div class="container">
        <h1>Unlock Full Access</h1>
        <div class="card">
          <h3 class="card-title">Bank Transfer Payment</h3>
          <p><strong>Bank Details:</strong></p>
          <div style="background: var(--bg); padding: 1rem; border-radius: 4px; margin: 1rem 0;">
            <p><strong>Bank Name:</strong> Commercial Bank of Sri Lanka</p>
            <p><strong>Account Name:</strong> Korean Pro Education</p>
            <p><strong>Account Number:</strong> 1234567890</p>
            <p><strong>Branch:</strong> Colombo Main</p>
            <p><strong>SWIFT Code:</strong> CCEYLKLX</p>
          </div>
          <p><strong>Amount:</strong> LKR 15,000</p>
          <p class="mt-1">After making the payment, submit the details below:</p>
          <form id="paymentForm" class="mt-1">
            <div class="form-group">
              <label>Your Name</label>
              <input type="text" id="paymentName" required>
            </div>
            <div class="form-group">
              <label>Amount Paid (LKR)</label>
              <input type="number" id="paymentAmount" required>
            </div>
            <div class="form-group">
              <label>Transaction Reference</label>
              <input type="text" id="paymentRef" required>
            </div>
            <div class="form-group">
              <label>Payment Proof (Optional)</label>
              <input type="file" id="paymentProof" accept="image/*">
            </div>
            <button type="submit" class="btn btn-accent">Submit Payment Request</button>
          </form>
        </div>
      </div>
    </div>

    <!-- ADMIN PAGE -->
    <div id="adminPage" class="page">
      <div class="container">
        <h1>Admin Panel</h1>
        
        <!-- TABS -->
        <div class="flex gap-1 mb-1" style="border-bottom: 2px solid var(--border);">
          <button class="btn btn-secondary admin-tab active" data-tab="users">Users</button>
          <button class="btn btn-secondary admin-tab" data-tab="payments">Payments</button>
          <button class="btn btn-secondary admin-tab" data-tab="videos">Videos</button>
          <button class="btn btn-secondary admin-tab" data-tab="quizzes">Quizzes</button>
        </div>

        <!-- USERS TAB -->
        <div id="adminUsersTab" class="admin-tab-content">
          <div class="card">
            <h3 class="card-title">Manage Users</h3>
            <div class="table-container">
              <table id="usersTable">
                <thead>
                  <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Paid Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- PAYMENTS TAB -->
        <div id="adminPaymentsTab" class="admin-tab-content hidden">
          <div class="card">
            <h3 class="card-title">Pending Payments</h3>
            <div id="paymentsContent"></div>
          </div>
        </div>

        <!-- VIDEOS TAB -->
        <div id="adminVideosTab" class="admin-tab-content hidden">
          <div class="card">
            <h3 class="card-title">Manage Videos</h3>
            <button class="btn btn-primary mb-1" id="addVideoBtn">Add New Video</button>
            <div id="videosContent"></div>
          </div>
        </div>

        <!-- QUIZZES TAB -->
        <div id="adminQuizzesTab" class="admin-tab-content hidden">
          <div class="card">
            <h3 class="card-title">Manage Quizzes</h3>
            <button class="btn btn-primary mb-1" id="addQuizBtn">Add New Quiz</button>
            <div id="adminQuizzesContent"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- MODALS -->
  <div id="quizModal" class="modal">
    <div class="modal-content">
      <h3 id="quizTitle"></h3>
      <div id="quizQuestion" class="mb-1"></div>
      <div id="quizOptions"></div>
      <div id="quizResult" class="mt-1"></div>
      <button class="btn btn-secondary mt-1" id="closeQuizBtn">Close</button>
    </div>
  </div>

  <div id="videoModal" class="modal">
    <div class="modal-content">
      <h3 id="videoTitle"></h3>
      <div id="videoPlayer"></div>
      <div id="videoNotes" class="mt-1"></div>
      <button class="btn btn-primary mt-1" id="markCompleteBtn">Mark as Complete</button>
      <button class="btn btn-secondary mt-1" id="closeVideoBtn">Close</button>
    </div>
  </div>

  <script>
    /* =================================================================
       GLOBAL STATE & DATA
       ================================================================= */
    
    const STATE = {
      currentUser: null,
      currentPage: 'loginPage',
      quizLanguage: 'korean', // korean or sinhala
      theme: 'light'
    };

    // DEMO USERS - Replace with backend authentication
    const USERS = JSON.parse(localStorage.getItem('users') || JSON.stringify([
      { username: 'admin', password: 'admin123', email: 'admin@koreanpro.com', isAdmin: true, isPaid: true },
      { username: 'student1', password: 'student123', email: 'student1@test.com', isPaid: true },
      { username: 'student2', password: 'student123', email: 'student2@test.com', isPaid: false },
      { username: 'student3', password: 'student123', email: 'student3@test.com', isPaid: false },
      { username: 'student4', password: 'student123', email: 'student4@test.com', isPaid: false },
      { username: 'student5', password: 'student123', email: 'student5@test.com', isPaid: false },
      { username: 'student6', password: 'student123', email: 'student6@test.com', isPaid: false }
    ]));

    // DEMO VIDEOS - Replace with backend API
    const VIDEOS = JSON.parse(localStorage.getItem('videos') || JSON.stringify([
      {
        id: 1,
        title: 'Korean Alphabet Basics (ÌïúÍ∏Ä)',
        course: 'Beginner',
        level: 'Level 1',
        lessonNo: 1,
        url: 'https://www.youtube.com/embed/s5aobqyEaMQ',
        type: 'youtube',
        notes: 'Introduction to Hangul characters',
        summary: 'Learn the Korean alphabet system and basic pronunciation'
      },
      {
        id: 2,
        title: 'Basic Greetings (Ïù∏ÏÇ¨Îßê)',
        course: 'Beginner',
        level: 'Level 1',
        lessonNo: 2,
        url: 'https://www.youtube.com/embed/TpqnNV8QqkU',
        type: 'youtube',
        notes: 'Common Korean greetings and responses',
        summary: 'Master essential greeting phrases for daily conversation'
      },
      {
        id: 3,
        title: 'EPS-TOPIK Grammar Lesson',
        course: 'EPS-TOPIK',
        level: 'Level 2',
        lessonNo: 1,
        url: 'https://example.com/video.mp4',
        type: 'mp4',
        notes: 'Essential grammar patterns for EPS-TOPIK exam',
        summary: 'Study key grammar structures frequently tested in EPS-TOPIK'
      }
    ]));

    // DEMO QUIZZES - Replace with backend API
    const QUIZZES = JSON.parse(localStorage.getItem('quizzes') || JSON.stringify([
      {
        id: 1,
        date: '2025-01-01',
        courseLevel: 'Beginner',
        question_kor: 'ÏïàÎÖïÌïòÏÑ∏ÏöîÎäî Î¨¥Ïä® ÎúªÏûÖÎãàÍπå?',
        question_sinhala: '"ÏïàÎÖïÌïòÏÑ∏Ïöî" ‡∂∫‡∂±‡∑ä‡∂±‡∑ô‡∂±‡∑ä ‡∂Ö‡∂Ø‡∑Ñ‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±‡∑ö ‡∂ö‡∑î‡∂∏‡∂ö‡∑ä‡∂Ø?',
        choices_kor: ['ÏïàÎÖïÌïòÏÑ∏Ïöî', 'Í∞êÏÇ¨Ìï©ÎãàÎã§', 'ÎØ∏ÏïàÌï©ÎãàÎã§', 'Ïûò Í∞ÄÏÑ∏Ïöî'],
        choices_sinhala: ['‡∑Ñ‡∑ô‡∂Ω‡∑ù / ‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä', '‡∑É‡∑ä‡∂≠‡∑ñ‡∂≠‡∑í‡∂∫‡∑í', '‡∑É‡∂∏‡∑è‡∑Ä‡∑ô‡∂±‡∑ä‡∂±', '‡∂ú‡∑í‡∑Ñ‡∑í‡∂±‡∑ä ‡∂ë‡∂±‡∑ä‡∂±'],
        correctIndex: 0
      },
      {
        id: 2,
        date: '2025-01-02',
        courseLevel: 'Beginner',
        question_kor: '"Í∞êÏÇ¨Ìï©ÎãàÎã§"Ïùò ÏùòÎØ∏Îäî?',
        question_sinhala: '"Í∞êÏÇ¨Ìï©ÎãàÎã§" ‡∑Ñ‡∑í ‡∂≠‡∑ö‡∂ª‡∑î‡∂∏ ‡∂ö‡∑î‡∂∏‡∂ö‡∑ä‡∂Ø?',
        choices_kor: ['ÏïàÎÖïÌûà Í∞ÄÏÑ∏Ïöî', 'Í∞êÏÇ¨Ìï©ÎãàÎã§', 'Ï£ÑÏÜ°Ìï©ÎãàÎã§', 'ÎÑ§'],
        choices_sinhala: ['‡∂ú‡∑í‡∑Ñ‡∑í‡∂±‡∑ä ‡∂ë‡∂±‡∑ä‡∂±', '‡∑É‡∑ä‡∂≠‡∑ñ‡∂≠‡∑í‡∂∫‡∑í', '‡∑É‡∂∏‡∑è‡∑Ä‡∑ô‡∂±‡∑ä‡∂±', '‡∂î‡∑Ä‡∑ä'],
        correctIndex: 1
      },
      {
        id: 3,
        date: '2025-01-03',
        courseLevel: 'Beginner',
        question_kor: 'ÌïúÍµ≠Ïñ¥Î°ú "1"ÏùÄ?',
        question_sinhala: '‡∂ö‡∑ú‡∂ª‡∑í‡∂∫‡∑è‡∂±‡∑î ‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä‡∑ô‡∂±‡∑ä "1" ‡∂ö‡∑í‡∂∫‡∂±‡∑ä‡∂±‡∑ö ‡∂ö‡∑ô‡∑É‡∑ö‡∂Ø?',
        choices_kor: ['ÌïòÎÇò', 'Îëò', 'ÏÖã', 'ÎÑ∑'],
        choices_sinhala: ['ÌïòÎÇò (‡∑Ñ‡∑è‡∂±‡∑è)', 'Îëò (‡∂Ø‡∑ñ‡∂Ω‡∑ä)', 'ÏÖã (‡∑É‡∑ô‡∂ß‡∑ä)', 'ÎÑ∑ (‡∂±‡∑ô‡∂ß‡∑ä)'],
        correctIndex: 0
      },
      {
        id: 4,
        date: '2025-01-04',
        courseLevel: 'Beginner',
        question_kor: '"ÎÑ§"Ïùò ÎúªÏùÄ?',
        question_sinhala: '"ÎÑ§" ‡∑Ñ‡∑í ‡∂≠‡∑ö‡∂ª‡∑î‡∂∏ ‡∂ö‡∑î‡∂∏‡∂ö‡∑ä‡∂Ø?',
        choices_kor: ['ÏïÑÎãàÏöî', 'ÎÑ§', 'Î™®Î•¥Í≤†Ïñ¥Ïöî', 'ÏïÑÎßàÎèÑ'],
        choices_sinhala: ['‡∂±‡∑ê‡∑Ñ‡∑ê', '‡∂î‡∑Ä‡∑ä', '‡∂∏‡∂∏ ‡∂Ø‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∑ê‡∑Ñ‡∑ê', '‡∑É‡∂∏‡∑Ñ‡∂ª ‡∑Ä‡∑í‡∂ß'],
        correctIndex: 1
      },
      {
        id: 5,
        date: '2025-01-05',
        courseLevel: 'Beginner',
        question_kor: 'ÌïúÍµ≠Ïñ¥Î°ú "Î¨º"ÏùÄ Î¨¥ÏóáÏûÖÎãàÍπå?',
        question_sinhala: '‡∂ö‡∑ú‡∂ª‡∑í‡∂∫‡∑è‡∂±‡∑î ‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä‡∑ô‡∂±‡∑ä "‡∑Ä‡∂≠‡∑î‡∂ª" ‡∂ö‡∑í‡∂∫‡∂±‡∑ä‡∂±‡∑ö ‡∂ö‡∑ô‡∑É‡∑ö‡∂Ø?',
        choices_kor: ['Î¨º', 'Î∞•', 'Îπµ', 'Ïö∞Ïú†'],
        choices_sinhala: ['Î¨º (‡∂∏‡∑î‡∂Ω‡∑ä)', 'Î∞• (‡∂∂‡∑è‡∂¥‡∑ä)', 'Îπµ (‡∂∑‡∑è‡∂Ç)', 'Ïö∞Ïú† (‡∂ã‡∂∫‡∑î)'],
        correctIndex: 0
      },
      {
        id: 6,
        date: '2025-01-06',
        courseLevel: 'EPS-TOPIK',
        question_kor: 'ÌöåÏÇ¨ÏóêÏÑú ÏùºÌï† Îïå Í∞ÄÏû• Ï§ëÏöîÌïú Í≤ÉÏùÄ?',
        question_sinhala: '‡∑É‡∂∏‡∑è‡∂ú‡∂∏‡∂ö ‡∑Ä‡∑ê‡∂© ‡∂ö‡∂ª‡∂± ‡∑Ä‡∑í‡∂ß ‡∑Ä‡∑ê‡∂Ø‡∂ú‡∂≠‡∑ä‡∂∏ ‡∂Ø‡∑ö ‡∂ö‡∑î‡∂∏‡∂ö‡∑ä‡∂Ø?',
        choices_kor: ['ÏïàÏ†Ñ', 'ÏÜçÎèÑ', 'Ïô∏Î™®', 'ÎÇòÏù¥'],
        choices_sinhala: ['‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä', '‡∑Ä‡∑ö‡∂ú‡∂∫', '‡∂¥‡∑ô‡∂±‡∑î‡∂∏', '‡∑Ä‡∂∫‡∑É'],
        correctIndex: 0
      },
      {
        id: 7,
        date: '2025-01-07',
        courseLevel: 'EPS-TOPIK',
        question_kor: 'ÏûëÏóÖÏû•ÏóêÏÑú "Î≥¥Ìò∏ Ïû•ÎπÑ"Î•º Ï∞©Ïö©Ìï¥Ïïº Ìï©ÎãàÍπå?',
        question_sinhala: '‡∑Ä‡∑ê‡∂© ‡∂ö‡∂ª‡∂± ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∑ö‡∂Ø‡∑ì "‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑í‡∂≠ ‡∂ã‡∂¥‡∂ö‡∂ª‡∂´" ‡∂¥‡∑ê‡∑Ö‡∂≥‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂Ø?',
        choices_kor: ['ÎÑ§, Î∞òÎìúÏãú', 'ÏïÑÎãàÏöî', 'ÏÑ†ÌÉù ÏÇ¨Ìï≠', 'Î™®Î•¥Í≤†ÏäµÎãàÎã§'],
        choices_sinhala: ['‡∂î‡∑Ä‡∑ä, ‡∂Ö‡∂±‡∑í‡∑Ä‡∑è‡∂ª‡∑ä‡∂∫‡∂∫‡∑ô‡∂±‡∑ä‡∂∏', '‡∂±‡∑ê‡∑Ñ‡∑ê', '‡∂≠‡∑ö‡∂ª‡∑ì‡∂∏‡∂ö‡∑í', '‡∂∏‡∂∏ ‡∂Ø‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∑ê‡∑Ñ‡∑ê'],
        correctIndex: 0
      },
      {
        id: 8,
        date: '2025-01-08',
        courseLevel: 'EPS-TOPIK',
        question_kor: '"Ìú¥Í∞Ä"Ïùò ÏùòÎØ∏Îäî?',
        question_sinhala: '"Ìú¥Í∞Ä" (‡∑Ñ‡∑í‡∂∫‡∑î‡∂ú‡∑è) ‡∑Ñ‡∑í ‡∂≠‡∑ö‡∂ª‡∑î‡∂∏ ‡∂ö‡∑î‡∂∏‡∂ö‡∑ä‡∂Ø?',
        choices_kor: ['Ïùº', 'Ìú¥Í∞Ä', 'ÌöåÏùò', 'ÏãùÏÇ¨'],
        choices_sinhala: ['‡∑Ä‡∑ê‡∂©', '‡∂±‡∑í‡∑Ä‡∑è‡∂©‡∑î‡∑Ä', '‡∂ª‡∑ê‡∑É‡∑ä‡∑Ä‡∑ì‡∂∏', '‡∂Ü‡∑Ñ‡∑è‡∂ª‡∂∫'],
        correctIndex: 1
      },
      {
        id: 9,
        date: '2025-01-09',
        courseLevel: 'EPS-TOPIK',
        question_kor: 'Í∏âÏó¨Îäî Ïñ∏Ï†ú Î∞õÏäµÎãàÍπå?',
        question_sinhala: '‡∑Ä‡∑ê‡∂ß‡∑î‡∂¥ ‡∂Ω‡∂∂‡∑è ‡∂ú‡∂±‡∑ä‡∂±‡∑ö ‡∂ö‡∑Ä‡∂Ø‡∑è‡∂Ø?',
        choices_kor: ['Îß§Ïùº', 'Îß§Ï£º', 'Îß§Ïõî', 'Îß§ÎÖÑ'],
        choices_sinhala: ['‡∂Ø‡∑í‡∂±‡∂¥‡∂≠‡∑è', '‡∑É‡∂≠‡∑í‡∂¥‡∂≠‡∑è', '‡∂∏‡∑è‡∑É‡∑í‡∂ö‡∑Ä', '‡∑Ä‡∑è‡∂ª‡∑ä‡∑Ç‡∑í‡∂ö‡∑Ä'],
        correctIndex: 2
      },
      {
        id: 10,
        date: '2025-01-10',
        courseLevel: 'TOPIK',
        question_kor: 'Îã§Ïùå Ï§ë Ï°¥ÎåìÎßêÏù¥ ÏïÑÎãå Í≤ÉÏùÄ?',
        question_sinhala: '‡∂¥‡∑Ñ‡∂≠ ‡∑É‡∂≥‡∑Ñ‡∂±‡∑ä ‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∂ú‡∑û‡∂ª‡∑Ä‡∂±‡∑ì‡∂∫ ‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä ‡∂±‡∑ú‡∑Ä‡∂±‡∑ä‡∂±‡∑ö ‡∂ö‡∑î‡∂∏‡∂ö‡∑ä‡∂Ø?',
        choices_kor: ['Í∞êÏÇ¨Ìï©ÎãàÎã§', 'Í≥†ÎßàÏõå', 'Ï£ÑÏÜ°Ìï©ÎãàÎã§', 'ÏïàÎÖïÌïòÏÑ∏Ïöî'],
        choices_sinhala: ['Í∞êÏÇ¨Ìï©ÎãàÎã§ (‡∂ú‡∂∏‡∑ä‡∑É‡∑è‡∑Ñ‡∑è‡∂∏‡∑ä‡∂±‡∑í‡∂Ø‡∑è)', 'Í≥†ÎßàÏõå (‡∂ú‡∑ú‡∂∏‡∑è‡∑Ä‡∑ù)', 'Ï£ÑÏÜ°Ìï©ÎãàÎã§ (‡∂†‡∑ô‡∑É‡∑ú‡∂Ç‡∑Ñ‡∑è‡∂∏‡∑ä‡∂±‡∑í‡∂Ø‡∑è)', 'ÏïàÎÖïÌïòÏÑ∏Ïöî (‡∂Ö‡∂±‡∑ä‡∂±‡∑ä‡∂∫‡∑ú‡∂Ç-‡∑Ñ‡∑è‡∑É‡∑ô‡∂∫‡∑ù)'],
        correctIndex: 1
      }
    ]));

    // USER PROGRESS - Replace with backend API
    const getUserProgress = () => {
      return JSON.parse(localStorage.getItem(`progress_${STATE.currentUser.username}`) || JSON.stringify({
        completedLessons: [],
        quizScores: {},
        watchedVideos: []
      }));
    };

    const saveUserProgress = (progress) => {
      localStorage.setItem(`progress_${STATE.currentUser.username}`, JSON.stringify(progress));
    };

    // PAYMENT REQUESTS - Replace with backend API
    const PAYMENT_REQUESTS = JSON.parse(localStorage.getItem('paymentRequests') || '[]');

    /* =================================================================
       AUTHENTICATION
       ================================================================= */

    const login = (username, password) => {
      const user = USERS.find(u => u.username === username && u.password === password);
      if (user) {
        STATE.currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(user));
        return true;
      }
      return false;
    };

    const signup = (username, email, password) => {
      if (USERS.find(u => u.username === username)) {
        return { success: false, message: 'Username already exists' };
      }
      const newUser = { username, email, password, isPaid: false, isAdmin: false };
      USERS.push(newUser);
      localStorage.setItem('users', JSON.stringify(USERS));
      return { success: true };
    };

    const logout = () => {
      STATE.currentUser = null;
      localStorage.removeItem('currentUser');
      showPage('loginPage');
      updateNav();
    };

    const checkAuth = () => {
      const stored = localStorage.getItem('currentUser');
      if (stored) {
        STATE.currentUser = JSON.parse(stored);
        // Sync with latest user data
        const latestUser = USERS.find(u => u.username === STATE.currentUser.username);
        if (latestUser) {
          STATE.currentUser = latestUser;
          localStorage.setItem('currentUser', JSON.stringify(latestUser));
        }
        showPage('dashboardPage');
        updateNav();
      }
    };

    /* =================================================================
       NAVIGATION
       ================================================================= */

    const showPage = (pageId) => {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      STATE.currentPage = pageId;
      
      // Load page content
      if (pageId === 'dashboardPage') loadDashboard();
      if (pageId === 'recordingsPage') loadRecordings();
      if (pageId === 'quizzesPage') loadQuizzes();
      if (pageId === 'adminPage') loadAdmin();
    };

    const updateNav = () => {
      const navLinks = document.getElementById('navLinks');
      const mobileMenu = document.getElementById('mobileMenu');
      
      let html = `
        <div class="toggle-container">
          <span>‚òÄÔ∏è</span>
          <div class="toggle ${STATE.theme === 'dark' ? 'active' : ''}" id="themeToggle">
            <div class="toggle-slider"></div>
          </div>
          <span>üåô</span>
        </div>
      `;
      
      if (STATE.currentUser) {
        html += `
          <a href="#" data-page="dashboardPage">Dashboard</a>
          <a href="#" data-page="recordingsPage">Recordings</a>
          <a href="#" data-page="quizzesPage">Quizzes</a>
        `;
        
        if (!STATE.currentUser.isPaid && !STATE.currentUser.isAdmin) {
          html += `<a href="#" data-page="paymentPage">Upgrade</a>`;
        }
        
        if (STATE.currentUser.isAdmin) {
          html += `<a href="#" data-page="adminPage">Admin</a>`;
        }
        
        html += `<button id="logoutBtn">Logout</button>`;
      }
      
      navLinks.innerHTML = html;
      mobileMenu.innerHTML = html;
      
      // Attach event listeners
      document.querySelectorAll('[data-page]').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          showPage(e.target.dataset.page);
          document.getElementById('mobileMenu').classList.remove('active');
        });
      });
      
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', logout);
      }
      
      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
      }
    };

    const toggleTheme = () => {
      STATE.theme = STATE.theme === 'light' ? 'dark' : 'light';
      document.body.dataset.theme = STATE.theme;
      localStorage.setItem('theme', STATE.theme);
      updateNav();
    };

    /* =================================================================
       DASHBOARD
       ================================================================= */

    const loadDashboard = () => {
      const progress = getUserProgress();
      const stats = document.getElementById('dashboardStats');
      const progressContent = document.getElementById('progressContent');
      
      const completedCount = progress.completedLessons.length;
      const quizzesTaken = Object.keys(progress.quizScores).length;
      const avgScore = quizzesTaken > 0 
        ? Math.round(Object.values(progress.quizScores).reduce((a, b) => a + b, 0) / quizzesTaken)
        : 0;
      
      stats.innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${completedCount}</div>
          <div class="stat-label">Lessons Completed</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, var(--accent), #d97706);">
          <div class="stat-value">${quizzesTaken}</div>
          <div class="stat-label">Quizzes Taken</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, var(--success), #059669);">
          <div class="stat-value">${avgScore}%</div>
          <div class="stat-label">Average Score</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);">
          <div class="stat-value">${STATE.currentUser.isPaid ? 'Premium' : 'Free'}</div>
          <div class="stat-label">Account Status</div>
        </div>
      `;
      
      progressContent.innerHTML = `
        <p><strong>Account:</strong> ${STATE.currentUser.username}</p>
        <p><strong>Email:</strong> ${STATE.currentUser.email}</p>
        <p><strong>Status:</strong> ${STATE.currentUser.isPaid ? '‚úì Premium Access' : '‚ö† Free Account - Upgrade for full access'}</p>
        ${!STATE.currentUser.isPaid && !STATE.currentUser.isAdmin ? `
          <button class="btn btn-accent mt-1" onclick="showPage('paymentPage')">Upgrade Now</button>
        ` : ''}
      `;
    };

    /* =================================================================
       RECORDINGS
       ================================================================= */

    const loadRecordings = () => {
      const content = document.getElementById('recordingsContent');
      
      if (!STATE.currentUser.isPaid && !STATE.currentUser.isAdmin) {
        content.innerHTML = `
          <div class="card text-center">
            <h3>üîí Premium Content</h3>
            <p>Unlock all video recordings with a premium account.</p>
            <button class="btn btn-accent mt-1" onclick="showPage('paymentPage')">Upgrade Now</button>
          </div>
        `;
        return;
      }
      
      // Group videos by course
      const grouped = {};
      VIDEOS.forEach(video => {
        if (!grouped[video.course]) grouped[video.course] = [];
        grouped[video.course].push(video);
      });
      
      let html = '';
      Object.keys(grouped).forEach(course => {
        html += `<h3 class="mt-1">${course}</h3>`;
        grouped[course].forEach(video => {
          html += `
            <div class="card">
              <h4>${video.title}</h4>
              <p><strong>Level:</strong> ${video.level} - Lesson ${video.lessonNo}</p>
              <p>${video.summary}</p>
              <button class="btn btn-primary" onclick="playVideo(${video.id})">Watch Lesson</button>
            </div>
          `;
        });
      });
      
      content.innerHTML = html;
    };

    const playVideo = (videoId) => {
      const video = VIDEOS.find(v => v.id === videoId);
      if (!video) return;
      
      const modal = document.getElementById('videoModal');
      const title = document.getElementById('videoTitle');
      const player = document.getElementById('videoPlayer');
      const notes = document.getElementById('videoNotes');
      
      title.textContent = video.title;
      notes.innerHTML = `<p><strong>Notes:</strong> ${video.notes}</p>`;
      
      if (video.type === 'youtube' || video.url.includes('youtube.com') || video.url.includes('youtu.be')) {
        player.innerHTML = `<div class="video-container"><iframe src="${video.url}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
      } else if (video.type === 'mp4' || video.url.endsWith('.mp4')) {
        player.innerHTML = `<div class="video-container"><video controls controlsList="nodownload" oncontextmenu="return false;"><source src="${video.url}" type="video/mp4">Your browser does not support video.</video></div>`;
      } else {
        player.innerHTML = `<div class="video-container"><iframe src="${video.url}" frameborder="0" allowfullscreen></iframe></div>`;
      }
      
      modal.classList.add('active');
      document.getElementById('markCompleteBtn').onclick = () => markLessonComplete(videoId);
    };

    const markLessonComplete = (videoId) => {
      const progress = getUserProgress();
      if (!progress.completedLessons.includes(videoId)) {
        progress.completedLessons.push(videoId);
        saveUserProgress(progress);
        alert('Lesson marked as complete! ‚úì');
        loadDashboard();
      }
    };

    /* =================================================================
       QUIZZES
       ================================================================= */

    const loadQuizzes = () => {
      const content = document.getElementById('quizzesContent');
      const lang = STATE.quizLanguage;
      
      let html = '';
      QUIZZES.forEach(quiz => {
        const question = lang === 'korean' ? quiz.question_kor : quiz.question_sinhala;
        const progress = getUserProgress();
        const score = progress.quizScores[quiz.id];
        
        html += `
          <div class="card">
            <div class="flex justify-between items-center">
              <div>
                <h4>Quiz ${quiz.id}: ${quiz.courseLevel}</h4>
                <p>${question.substring(0, 50)}...</p>
                <p><small>Released: ${quiz.date}</small></p>
              </div>
              <div>
                ${score !== undefined ? `<p class="text-success">Score: ${score}%</p>` : ''}
                <button class="btn btn-primary" onclick="startQuiz(${quiz.id})">
                  ${score !== undefined ? 'Retake' : 'Start'} Quiz
                </button>
              </div>
            </div>
          </div>
        `;
      });
      
      content.innerHTML = html;
    };

    const startQuiz = (quizId) => {
      const quiz = QUIZZES.find(q => q.id === quizId);
      if (!quiz) return;
      
      const modal = document.getElementById('quizModal');
      const title = document.getElementById('quizTitle');
      const question = document.getElementById('quizQuestion');
      const options = document.getElementById('quizOptions');
      const result = document.getElementById('quizResult');
      
      const lang = STATE.quizLanguage;
      const questionText = lang === 'korean' ? quiz.question_kor : quiz.question_sinhala;
      const choices = lang === 'korean' ? quiz.choices_kor : quiz.choices_sinhala;
      
      title.textContent = `Quiz ${quiz.id} - ${quiz.courseLevel}`;
      question.innerHTML = `<h4>${questionText}</h4>`;
      result.innerHTML = '';
      
      let optionsHtml = '';
      choices.forEach((choice, index) => {
        optionsHtml += `
          <div class="quiz-option" onclick="checkAnswer(${quizId}, ${index})">
            ${index + 1}. ${choice}
          </div>
        `;
      });
      
      options.innerHTML = optionsHtml;
      modal.classList.add('active');
    };

    const checkAnswer = (quizId, selectedIndex) => {
      const quiz = QUIZZES.find(q => q.id === quizId);
      const options = document.querySelectorAll('.quiz-option');
      const result = document.getElementById('quizResult');
      
      options.forEach(opt => opt.style.pointerEvents = 'none');
      
      if (selectedIndex === quiz.correctIndex) {
        options[selectedIndex].classList.add('correct');
        result.innerHTML = '<p class="text-success"><strong>‚úì Correct!</strong></p>';
        
        const progress = getUserProgress();
        progress.quizScores[quizId] = 100;
        saveUserProgress(progress);
      } else {
        options[selectedIndex].classList.add('incorrect');
        options[quiz.correctIndex].classList.add('correct');
        result.innerHTML = '<p class="text-error"><strong>‚úó Incorrect. The correct answer is highlighted.</strong></p>';
        
        const progress = getUserProgress();
        progress.quizScores[quizId] = 0;
        saveUserProgress(progress);
      }
      
      setTimeout(() => {
        loadDashboard();
      }, 1000);
    };

    /* =================================================================
       PAYMENT
       ================================================================= */

    const submitPayment = (e) => {
      e.preventDefault();
      
      const name = document.getElementById('paymentName').value;
      const amount = document.getElementById('paymentAmount').value;
      const ref = document.getElementById('paymentRef').value;
      const proof = document.getElementById('paymentProof').files[0];
      
      const request = {
        id: Date.now(),
        username: STATE.currentUser.username,
        name,
        amount,
        ref,
        proofName: proof ? proof.name : null,
        status: 'pending',
        date: new Date().toISOString()
      };
      
      PAYMENT_REQUESTS.push(request);
      localStorage.setItem('paymentRequests', JSON.stringify(PAYMENT_REQUESTS));
      
      alert('Payment request submitted! Admin will verify and approve your payment.');
      e.target.reset();
    };

    /* =================================================================
       ADMIN PANEL
       ================================================================= */

    const loadAdmin = () => {
      if (!STATE.currentUser.isAdmin) {
        showPage('dashboardPage');
        return;
      }
      
      loadAdminUsers();
      loadAdminPayments();
      loadAdminVideos();
      loadAdminQuizzes();
    };

    const loadAdminUsers = () => {
      const tbody = document.querySelector('#usersTable tbody');
      let html = '';
      
      USERS.filter(u => !u.isAdmin).forEach(user => {
        html += `
          <tr>
            <td>${user.username}</td>
            <td>${user.email}</td>
            <td>${user.isPaid ? '‚úì Paid' : '‚úó Free'}</td>
            <td>
              <button class="btn btn-success" onclick="toggleUserPaid('${user.username}')">
                ${user.isPaid ? 'Revoke' : 'Approve'} Access
              </button>
            </td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    };

    const toggleUserPaid = (username) => {
      const user = USERS.find(u => u.username === username);
      if (user) {
        user.isPaid = !user.isPaid;
        localStorage.setItem('users', JSON.stringify(USERS));
        
        // TODO: Send email notification (integrate with backend email service)
        alert(`User ${username} is now ${user.isPaid ? 'PAID' : 'FREE'}. Email notification sent (simulated).`);
        
        loadAdminUsers();
      }
    };

    const loadAdminPayments = () => {
      const content = document.getElementById('paymentsContent');
      const pending = PAYMENT_REQUESTS.filter(r => r.status === 'pending');
      
      if (pending.length === 0) {
        content.innerHTML = '<p>No pending payment requests.</p>';
        return;
      }
      
      let html = '';
      pending.forEach(req => {
        html += `
          <div class="card">
            <h4>${req.name} (${req.username})</h4>
            <p><strong>Amount:</strong> LKR ${req.amount}</p>
            <p><strong>Reference:</strong> ${req.ref}</p>
            <p><strong>Date:</strong> ${new Date(req.date).toLocaleString()}</p>
            ${req.proofName ? `<p><strong>Proof:</strong> ${req.proofName}</p>` : ''}
            <div class="flex gap-1 mt-1">
              <button class="btn btn-success" onclick="approvePayment(${req.id})">Approve</button>
              <button class="btn btn-error" onclick="rejectPayment(${req.id})">Reject</button>
            </div>
          </div>
        `;
      });
      
      content.innerHTML = html;
    };

    const approvePayment = (requestId) => {
      const req = PAYMENT_REQUESTS.find(r => r.id === requestId);
      if (req) {
        req.status = 'approved';
        localStorage.setItem('paymentRequests', JSON.stringify(PAYMENT_REQUESTS));
        
        toggleUserPaid(req.username);
        loadAdminPayments();
      }
    };

    const rejectPayment = (requestId) => {
      const req = PAYMENT_REQUESTS.find(r => r.id === requestId);
      if (req) {
        req.status = 'rejected';
        localStorage.setItem('paymentRequests', JSON.stringify(PAYMENT_REQUESTS));
        alert('Payment request rejected.');
        loadAdminPayments();
      }
    };

    const loadAdminVideos = () => {
      const content = document.getElementById('videosContent');
      let html = '<div class="table-container"><table><thead><tr><th>Title</th><th>Course</th><th>Lesson</th><th>Actions</th></tr></thead><tbody>';
      
      VIDEOS.forEach(video => {
        html += `
          <tr>
            <td>${video.title}</td>
            <td>${video.course}</td>
            <td>${video.level} - #${video.lessonNo}</td>
            <td><button class="btn btn-error" onclick="deleteVideo(${video.id})">Delete</button></td>
          </tr>
        `;
      });
      
      html += '</tbody></table></div>';
      content.innerHTML = html;
    };

    const deleteVideo = (videoId) => {
      if (confirm('Delete this video?')) {
        const index = VIDEOS.findIndex(v => v.id === videoId);
        if (index > -1) {
          VIDEOS.splice(index, 1);
          localStorage.setItem('videos', JSON.stringify(VIDEOS));
          loadAdminVideos();
        }
      }
    };

    const loadAdminQuizzes = () => {
      const content = document.getElementById('adminQuizzesContent');
      let html = '<div class="table-container"><table><thead><tr><th>ID</th><th>Level</th><th>Date</th><th>Question (KR)</th><th>Actions</th></tr></thead><tbody>';
      
      QUIZZES.forEach(quiz => {
        html += `
          <tr>
            <td>${quiz.id}</td>
            <td>${quiz.courseLevel}</td>
            <td>${quiz.date}</td>
            <td>${quiz.question_kor.substring(0, 30)}...</td>
            <td><button class="btn btn-error" onclick="deleteQuiz(${quiz.id})">Delete</button></td>
          </tr>
        `;
      });
      
      html += '</tbody></table></div>';
      content.innerHTML = html;
    };

    const deleteQuiz = (quizId) => {
      if (confirm('Delete this quiz?')) {
        const index = QUIZZES.findIndex(q => q.id === quizId);
        if (index > -1) {
          QUIZZES.splice(index, 1);
          localStorage.setItem('quizzes', JSON.stringify(QUIZZES));
          loadAdminQuizzes();
        }
      }
    };

    /* =================================================================
       EVENT LISTENERS
       ================================================================= */

    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      if (login(username, password)) {
        showPage('dashboardPage');
        updateNav();
      } else {
        alert('Invalid credentials');
      }
    });

    document.getElementById('signupForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('signupUsername').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      
      const result = signup(username, email, password);
      if (result.success) {
        alert('Account created! Please login.');
        showPage('loginPage');
      } else {
        alert(result.message);
      }
    });

    document.getElementById('showSignupLink').addEventListener('click', (e) => {
      e.preventDefault();
      showPage('signupPage');
    });

    document.getElementById('showLoginLink').addEventListener('click', (e) => {
      e.preventDefault();
      showPage('loginPage');
    });

    document.getElementById('paymentForm').addEventListener('submit', submitPayment);

    document.getElementById('quizLangToggle').addEventListener('click', () => {
      STATE.quizLanguage = STATE.quizLanguage === 'korean' ? 'sinhala' : 'korean';
      document.getElementById('quizLangToggle').classList.toggle('active');
      loadQuizzes();
    });

    document.getElementById('closeQuizBtn').addEventListener('click', () => {
      document.getElementById('quizModal').classList.remove('active');
    });

    document.getElementById('closeVideoBtn').addEventListener('click', () => {
      document.getElementById('videoModal').classList.remove('active');
      document.getElementById('videoPlayer').innerHTML = '';
    });

    document.getElementById('hamburgerBtn').addEventListener('click', () => {
      document.getElementById('mobileMenu').classList.toggle('active');
    });

    // Admin tabs
    document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.addEventListener('click', (e) => {
        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.add('hidden'));
        
        e.target.classList.add('active');
        const tabName = e.target.dataset.tab;
        document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).classList.remove('hidden');
      });
    });

    document.getElementById('addVideoBtn').addEventListener('click', () => {
      const url = prompt('Enter video URL (YouTube, MP4, or embed link):');
      if (url) {
        const title = prompt('Enter video title:');
        const course = prompt('Enter course (Beginner/EPS-TOPIK/TOPIK):');
        const level = prompt('Enter level (e.g., Level 1):');
        const lessonNo = parseInt(prompt('Enter lesson number:'));
        const notes = prompt('Enter lesson notes:');
        const summary = prompt('Enter lesson summary:');
        
        const newVideo = {
          id: VIDEOS.length + 1,
          title,
          course,
          level,
          lessonNo,
          url,
          type: url.includes('youtube') ? 'youtube' : url.endsWith('.mp4') ? 'mp4' : 'embed',
          notes,
          summary
        };
        
        VIDEOS.push(newVideo);
        localStorage.setItem('videos', JSON.stringify(VIDEOS));
        loadAdminVideos();
        alert('Video added successfully!');
      }
    });

    document.getElementById('addQuizBtn').addEventListener('click', () => {
      alert('Quiz creation form would go here. For demo, edit QUIZZES array directly.');
    });

    /* =================================================================
       PWA SERVICE WORKER
       ================================================================= */

    if ('serviceWorker' in navigator) {
      // Service worker registration
      const swCode = `
        const CACHE_NAME = 'korean-pro-v1';
        const urlsToCache = ['/'];
        
        self.addEventListener('install', event => {
          event.waitUntil(
            caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
          );
        });
        
        self.addEventListener('fetch', event => {
          event.respondWith(
            caches.match(event.request).then(response => {
              return response || fetch(event.request);
            })
          );
        });
      `;
      
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      
      navigator.serviceWorker.register(swUrl).then(() => {
        console.log('Service Worker registered');
      }).catch(err => {
        console.log('Service Worker registration failed:', err);
      });
    }

    // Web App Manifest
    const manifest = {
      name: 'Korean Pro',
      short_name: 'KoreanPro',
      start_url: '/',
      display: 'standalone',
      background_color: '#1e40af',
      theme_color: '#1e40af',
      icons: [
        {
          src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192"><circle cx="96" cy="96" r="96" fill="%231e40af"/><text x="96" y="130" text-anchor="middle" fill="%23f59e0b" font-size="100" font-weight="bold">K</text></svg>',
          sizes: '192x192',
          type: 'image/svg+xml'
        }
      ]
    };

    const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
    const manifestUrl = URL.createObjectURL(manifestBlob);
    document.getElementById('manifest-placeholder').setAttribute('href', manifestUrl);

    /* =================================================================
       INITIALIZATION
       ================================================================= */

    // Load theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    STATE.theme = savedTheme;
    document.body.dataset.theme = savedTheme;

    // Check authentication on load
    checkAuth();
    updateNav();

  </script>
</body>
</html>
